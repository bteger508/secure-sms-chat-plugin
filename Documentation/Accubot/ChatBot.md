# ChatBot Directory

This directory aims to be as self contained as possible for all of the code related to the chatbot. The entrypoint for the code is the `Accubot` class, which uses the `PredictIntent` and `GenerateResponse` methods to predict the intent of a user's message and use the prediction to generate a reply.

## Accubot

This class is injected into `SignalRChat.Hubs.ChatHub` to automatically reply to incoming messages. **I wasn't able to figure out how to access the training data with a relative path, so the code for getting the base directory is less than ideal. The chatbot assumes that you are running the secure chat system in a docker container. Otherwise, it will not be able to find the training data or responses json file in the Data folder.**

The LICENSE will need to be updated to reflect the license Accutech wishes to use for the chatbot. The README also provides citations for the tutorials that were adapted and used as inspiration for the chatbot.

## Subfolders

Here is a basic overview of each of the subfolders and their contents.

### Data

This directory contains the training data for chatbot, and a json file with the static responses the chatbot can use for
those intents that do not require a dynamically generated response.

### DataStructures

This directory contains the datastructures needed for the chatbot.

1. Inquiry - contains the message string sent by the user (I call this variable `Text`), and the `IntentPrediction` object for the message

2. Inquiry Response - the response object generated by the `GenerateResponse` method in `Accubot.cs`
   - `Response` - the string message the chatbot generates to reply to the user
   - `ResponseType` - `SignalRChat.Hubs.ChatHub` checks if this field is assigned the value "pass-off". If so, the chathub sets the conversation record's "PassOff" column to true, and the chatbot no longer replies to new messages in that conversation
   - `Inquiry` - this value gets set, but is not used for anything useful yet.
   - `Intent` - represents a row in the intents.tsv training data file
   - `IntentPrediction` - the return type of the `PredictIntent` method in `Accubot.cs`
     - Contains the predicted intent (`Tag`) and the `Scores` array from the one-versus-all classifier
   - `IntentResponse` - represents a single object in the responses.json
     - Contains the intent (`Tag`) and a list of strings `Responses` corresponding for the the intent
   - `StockLastQuote` - matches the structure of the stock price JSON retrieved from Finage in `MarketDataHandler`
   - `StockPriceInquiry` - similar to an `Inquiry`, but with two extra fields required by `StockPriceTopicHandler.cs`:
     - `Tag` - the predicted intent for the Inquiry
     - `Symbol` - the stock ticker symbol the user wants the chatbot to query
   - `StockPriceInquiryResponse` - a duplicate of `InquiryResponse` that should be removed

### Interfaces

This directory contains all of the interfaces used by the chatbot. These interfaces are used to register the chatbot's dependencies for injection in the `Startup.cs` class

### Services

Contains all classes that retrieve data or perform calculations for topic handler classes.

### Topic Handlers

Contains all of the topic handler classes used by the Accubot class to generate dynamic responses to message intents. Each intent that requires a dynamically generated response gets a dedicated topic handler class. The naming convention is `<IntentName>TopicHandler`.

## Dependencies

The SignalRChat/ChatBot directory is not entirely self contained. It contains all of the code for the chatbot, but with some important dependencies to the rest of the system. All of the classes for the chatbot use dependency injection. The following interfaces/classes are registered in Startup.cs:

- TopicHandlers and their interfaces

  - `IStockPriceTopicHandler` => `StockPriceTopicHandler`
  - `IAccountTopicHandler` => `AccountTopicHandler`

- Services and their interfaces

  - `IMarketDataService` => `MarketDataService`
  - `IAccountDataService` => `IAccountDataService`

- `Accubot` is used by the `ChatHub` class (SignalRChat/Hubs/ChatHub.cs)
  - `IAccubot` => `Accubot`

**Additionally, the secure chat system needs a user account for accubot in order for the bot to send messages. `SignalRChat.Data.ApplicationDbContext` seeds accubot with userid = 1.**
